<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>番茄钟</title>
  <!-- CSS 样式文件 -->
  <link rel="stylesheet" href="styles/base.css">
  <link rel="stylesheet" href="styles/sidebar.css">
  <link rel="stylesheet" href="styles/main-content.css">
  <link rel="stylesheet" href="styles/music-player.css">
  <link rel="stylesheet" href="styles/modal.css">
  <link rel="stylesheet" href="styles/modes.css">
</head>
<body>
  <div class="window-frame">
    <div class="container">
      <div class="draggable"></div>
      <button class="btn-close">×</button>
      <button class="btn-minimize">−</button>
      
      <!-- 模式切换滑块 -->
      <div class="mode-slider-container">
        <div class="mode-slider" id="modeSlider">
          <div class="mode-slider-thumb" id="modeSliderThumb"></div>
        </div>
        <div class="mode-slider-labels">
          <span class="mode-label active" data-mode="single">单次</span>
          <span class="mode-label" data-mode="plan">计划</span>
        </div>
      </div>
      
      <!-- 左侧边栏 -->
      <div class="sidebar">
        <!-- 单次模式：时间预设 -->
        <div class="single-mode-content" id="singleModeContent">
          <h2 class="sidebar-title">时间预设</h2>
          
          <!-- 预设列表 -->
          <div class="preset-list" id="presetList">
            <!-- 由 JS 动态生成 -->
          </div>
        </div>
        
        <!-- 计划模式：任务列表 -->
        <div class="plan-mode-content" id="planModeContent" style="display: none;">
          <h2 class="sidebar-title">番茄计划</h2>
          
          <!-- 计划列表 -->
          <div class="plan-list" id="planList">
            <!-- 由 JS 动态生成 -->
          </div>
        </div>
        
        <!-- 添加预设/计划 -->
        <div class="add-preset-section">
          <div class="wheel-picker-container">
            <div class="wheel-picker" id="wheelPicker">
              <div class="wheel-picker-column" id="wheelColumn"></div>
            </div>
            <span>分钟</span>
            <!-- 单次模式：一个加号 -->
            <button class="btn-add-preset" id="addPresetBtn">+</button>
          </div>
          <!-- 计划模式：两个加号在下方 -->
          <div class="plan-add-buttons" id="planAddButtons" style="display: none;">
            <button class="btn-add-plan btn-add-work" id="addWorkBtn" title="添加工作时间">+ 工作</button>
            <button class="btn-add-plan btn-add-break" id="addBreakBtn" title="添加休息时间">+ 休息</button>
          </div>
        </div>

        <!-- 统计信息 -->
        <div class="sidebar-stats">
          <div class="stat-item">
            <span class="stat-label">今日完成</span>
            <span class="stat-value" id="todayCount">0</span>
            <span class="stat-unit">个</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">累计专注</span>
            <span class="stat-value" id="totalMinutes">0</span>
            <span class="stat-unit">分钟</span>
          </div>
        </div>
      </div>
      
      <!-- 右侧主区域 -->
      <div class="main-content">
        <button class="btn-tutorial" id="tutorialBtn">📖</button>
        <h1 class="title">🍅 番茄钟</h1>
        
        <div class="mode-switch">
          <div class="mode-btn active" data-mode="work">
            <span class="mode-icon">💼</span>
            <span class="mode-text">工作</span>
          </div>
          <div class="mode-btn" data-mode="break">
            <span class="mode-icon">☕</span>
            <span class="mode-text">休息</span>
          </div>
        </div>
        
        <div class="timer-container">
          <svg class="progress-ring" viewBox="0 0 240 240">
            <circle class="bg" cx="120" cy="120" r="116"></circle>
            <circle class="progress" cx="120" cy="120" r="116" id="progressCircle"></circle>
          </svg>
          <div class="timer-inner">
            <div class="time-display" id="timeDisplay">25:00</div>
          </div>
        </div>
        
        <div class="buttons">
          <button class="btn btn-start" id="startBtn">开始</button>
          <button class="btn btn-reset">重置</button>
        </div>
        
        <p class="status" id="status">准备开始专注工作</p>

        <!-- 音乐播放器 -->
        <div class="music-player" id="musicPlayer">
          <div class="music-info">
            <span class="music-icon">🎵</span>
            <span class="music-track-name" id="trackName">未播放</span>
            <button class="music-device-btn" id="deviceBtn" title="选择输出设备">🎧</button>
            <div class="music-device-list" id="deviceList"></div>
          </div>
          <div class="music-progress-container">
            <span class="music-time" id="currentTime">0:00</span>
            <div class="music-progress-bar" id="progressBar">
              <div class="music-progress-fill" id="progressFill"></div>
              <div class="music-progress-handle" id="progressHandle"></div>
            </div>
            <span class="music-time" id="duration">0:00</span>
          </div>
          <div class="music-controls">
            <button class="music-btn music-prev" id="prevBtn">⏮</button>
            <button class="music-btn music-play" id="playBtn" data-playing="false">▶</button>
            <button class="music-btn music-next" id="nextBtn">⏭</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 教程弹窗 -->
    <div class="tutorial-modal" id="tutorialModal">
      <div class="tutorial-content">
        <button class="tutorial-close" id="tutorialClose">×</button>
        <h2>📖 使用说明</h2>
        <div class="tutorial-body">
          <h3>🔄 模式切换</h3>
          <p>顶部滑块可切换 <b>单次模式</b> 和 <b>计划模式</b>：</p>
          <p>• <b>单次模式</b>：传统番茄钟，手动设置时间计时</p>
          <p>• <b>计划模式</b>：创建任务列表，自动依次执行</p>
          
          <h3>⏱️ 单次模式</h3>
          <p>1. 在左侧选择时间预设，点击即可设置计时时长</p>
          <p>2. 使用滚轮选择器可以自定义时间（1-120分钟）</p>
          <p>3. 点击 "+" 按钮将滚轮当前时间添加为新的预设</p>
          <p>4. 点击预设右侧的 "×" 可删除该预设</p>
          <p>5. 点击 "工作" 或 "休息" 按钮切换模式，不同模式有独立的时间预设列表</p>
          
          <h3>📝 计划模式</h3>
          <p>1. 使用滚轮选择时间，点击 "+ 工作" 或 "+ 休息" 添加任务到列表</p>
          <p>2. 拖拽列表项可调整任务顺序</p>
          <p>3. 点击任务右侧 "×" 可删除任务</p>
          <p>4. 点击 "开始" 按钮开始执行计划，任务将自动依次执行</p>
          <p>5. 点击 "重置" 按钮停止计划并恢复到第一个任务</p>
          <p>6. 工作任务显示为红色，休息任务显示为绿色</p>
          
          <h3>🎵 音乐播放器</h3>
          <p>底部音乐播放器可在专注时播放音乐：</p>
          <p>• <b>播放控制</b>：播放/暂停、上一首、下一首</p>
          <p>• <b>进度条</b>：点击或拖动进度条跳转播放位置</p>
          <p>• <b>音量控制</b>：快捷键 Ctrl+↑/↓ 调节音量</p>
          <p>• <b>设备切换</b>：点击设备按钮选择音频输出设备</p>
          <p>• <b>随机播放</b>：启动时自动随机排序播放列表</p>
          <p>• <b>自动连播</b>：歌曲结束自动播放下一首</p>
          
          <h3>📊 统计数据</h3>
          <p>左侧底部显示今日完成的番茄数和累计专注时间，数据会自动保存</p>
          
          <h3>⚙️ 窗口操作</h3>
          <p>• 点击右上角 "−" 最小化窗口到任务栏</p>
          <p>• 点击右上角 "×" 关闭应用</p>
          <p>• 拖动顶部空白区域可移动窗口</p>
        </div>
      </div>
    </div>
  </div>

  <!-- 按依赖顺序加载 JS 模块 -->
  <!-- 基础模块 -->
  <script src="scripts/modules/dom.js"></script>
  <script src="scripts/modules/dataStore.js"></script>
  <script src="scripts/modules/stats.js"></script>
  
  <!-- 功能模块 -->
  <script src="scripts/modules/wheelPicker.js"></script>
  <script src="scripts/modules/presets.js"></script>
  <script src="scripts/modules/planMode.js"></script>
  <script src="scripts/modules/timer.js"></script>
  <script src="scripts/modules/mode.js"></script>
  <script src="scripts/modules/musicPlayer.js"></script>
  
  <!-- 应用逻辑模块 -->
  <script src="scripts/modules/appState.js"></script>
  <script src="scripts/modules/tutorial.js"></script>
  <script src="scripts/modules/callbacks.js"></script>
  
  <!-- 主入口 -->
  <script src="scripts/renderer.js"></script>
</body>
</html>